<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plano de Ação Interativo DPRO</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 700px; 
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }
        .status-A-iniciar { background-color: #fecaca; } /* red-200 */
        .status-Em-andamento { background-color: #fef08a; } /* yellow-200 */
        .status-Concluído { background-color: #bbf7d0; } /* green-200 */
        .status-Contínuo { background-color: #bfdbfe; } /* blue-200 */
        .status-Planejamento { background-color: #e9d5ff; } /* purple-200 */
        .status-NA { background-color: #e5e7eb; } /* gray-200 */
    </style>
</head>
<body class="p-4 sm:p-6">
    <div class="w-full max-w-7xl mx-auto bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
        <header class="text-center mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Plano de Ação DPRO</h1>
            <p class="text-md text-gray-600 mt-2">Navegue entre a visão gráfica, o plano de ação e o dashboard de acompanhamento.</p>
        </header>

        <!-- Abas de Navegação -->
        <div class="flex flex-wrap justify-center border-b border-gray-200 mb-8">
            <button id="graph-tab" class="tab-button active text-lg font-semibold py-3 px-6 rounded-t-lg -mb-px">Visão Gráfica</button>
            <button id="plan-tab" class="tab-button text-lg font-semibold py-3 px-6 text-gray-600 rounded-t-lg -mb-px">Plano de Ação</button>
            <button id="dashboard-tab" class="tab-button text-lg font-semibold py-3 px-6 text-gray-600 rounded-t-lg -mb-px">Dashboard</button>
        </div>

        <!-- Conteúdo das Abas -->
        <main>
            <!-- Visão Gráfica -->
            <div id="graph-view">
                <p class="text-center text-gray-500 mb-4">Clique em uma barra para ver os comentários e sugestões da categoria.</p>
                <div id="chart-container" class="relative mx-auto h-[85vh] w-full max-w-4xl">
                    <canvas id="complaintsChart"></canvas>
                </div>
            </div>
            
            <!-- Visão Plano de Ação -->
            <div id="plan-view" class="hidden">
                 <!-- Legenda -->
                <div class="flex flex-wrap justify-center gap-x-6 gap-y-2 mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center"><span class="h-4 w-4 block rounded-full bg-red-200 mr-2 border border-red-300"></span><span class="text-sm text-gray-700">A iniciar</span></div>
                    <div class="flex items-center"><span class="h-4 w-4 block rounded-full bg-yellow-200 mr-2 border border-yellow-300"></span><span class="text-sm text-gray-700">Em andamento</span></div>
                    <div class="flex items-center"><span class="h-4 w-4 block rounded-full bg-green-200 mr-2 border border-green-300"></span><span class="text-sm text-gray-700">Concluído</span></div>
                    <div class="flex items-center"><span class="h-4 w-4 block rounded-full bg-blue-200 mr-2 border border-blue-300"></span><span class="text-sm text-gray-700">Contínuo</span></div>
                    <div class="flex items-center"><span class="h-4 w-4 block rounded-full bg-purple-200 mr-2 border border-purple-300"></span><span class="text-sm text-gray-700">Planejamento</span></div>
                    <div class="flex items-center"><span class="h-4 w-4 block rounded-full bg-gray-200 mr-2 border border-gray-300"></span><span class="text-sm text-gray-700">N/A</span></div>
                </div>
                 <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200 table-fixed">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[15%]">Categoria</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[25%]">Ação Proposta</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[25%]">Objetivo</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[15%]">Responsável</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[10%]">Prazo</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-[10%]">Status</th>
                            </tr>
                        </thead>
                        <tbody id="action-plan-tbody" class="bg-white divide-y divide-gray-200">
                            <!-- Linhas da tabela serão inseridas aqui via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

             <!-- Visão Dashboard -->
            <div id="dashboard-view" class="hidden">
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10 p-6 bg-gray-50 rounded-xl">
                    <div>
                        <h3 class="text-lg font-semibold text-center text-gray-700 mb-4">Ações por Status</h3>
                        <div class="h-64 w-full flex items-center justify-center">
                           <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-center text-gray-700 mb-4">Cronograma de Prazos (Ações Pendentes)</h3>
                        <div class="h-64 w-full">
                           <canvas id="deadlineChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para Detalhes da Categoria -->
    <div id="detailsModal" class="modal-overlay">
        <div class="modal-content relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            <h2 id="modalTitle" class="text-2xl font-bold text-gray-800 mb-6"></h2>
            <div id="modalBody" class="space-y-2">
                <!-- Conteúdo dinâmico aqui -->
            </div>
        </div>
    </div>

    <script>
        // --- ESTRUTURA DE DADOS ---
        const planData = [
            { id: 1, category: "Sistemas e Processos", action: "DFT – melhorias no sistema (Etapa 3 / SISDIP) • Transferência do conhecimento do SISDIP para todos os órgãos SIPEC. • Manual prático, sensibilização, capacitação e plantão de dúvidas. • Acompanhamento mensal do preenchimento dos dados em 2025. • Canal direto COEPE/MGI para sugestões de melhorias.", prazo: "2025 (execução contínua)", objetivo: "Dar clareza às opções do DFT e apoiar todos os órgãos SIPEC na utilização do SISDIP.", responsavel: "MGI / COEPE / DPRO", status: "Em andamento" },
            { id: 2, category: "Sistemas e Processos", action: "PGD – reformulação geral do sistema PGD-e • API para envio de dados ao MGI já desenvolvida. • Entregas em desenvolvimento (DIGI/SGE): Planejamento Estratégico, Cadeia de Valor, PEE, PPI, TCR, Avaliação do PPI, Avaliação do PEE, Relatório de Resultados, API ao MGI. • Em homologação: Planejamento Estratégico, Cadeia de Valor, PEE, PPI, TCR, Avaliação do PPI. • A desenvolver: Avaliação do PEE, Relatório de Resultados, API ao MGI. • Pontos de atenção: 34 evolutivas mapeadas pendentes. • Suporte PGD incorporado ao AGU Serviços.", prazo: "2025 (execução por fases)", objetivo: "Melhorar usabilidade, reduzir sobrecarga de alertas e ampliar funcionalidades estratégicas do PGD-e.", responsavel: "DIGI/SGE / DPRO", status: "Em andamento" },
            { id: 3, category: "Sistemas e Processos", action: "Mapeamento dos formulários de solicitação de serviços • Opção 1: disponibilizar em PDF para aposentados. • Opção 2: incluir modelos de requerimento no SUPER SAPIENS.", prazo: "2025", objetivo: "Garantir acessibilidade e padronização dos formulários de serviços.", responsavel: "DPRO", status: "Planejamento" },
            { id: 4, category: "Comunicação e Serviços da DPRO", action: "Live específica sobre os serviços da DPRO", prazo: "A partir de Out/2025 e contínuo", objetivo: "Ampliar a divulgação e o entendimento sobre os serviços da DPRO, promovendo maior transparência e engajamento.", responsavel: "DPRO / ASCOM", status: "A iniciar" },
            { id: 5, category: "Comunicação e Serviços da DPRO", action: "Pílulas de WhatsApp (plano de comunicação com a ASCOM)", prazo: "dez/25", objetivo: "Criar e implementar plano de comunicação em parceria com a ASCOM para envio de conteúdos curtos e informativos.", responsavel: "DPRO / ASCOM", status: "Planejamento" },
            { id: 6, category: "Comunicação e Serviços da DPRO", action: "Revisão e atualização das páginas de serviço da DPRO (com apoio da FGV)", prazo: "dez/25", objetivo: "Melhorar a gestão do conhecimento e a manualização dos serviços ofertados.", responsavel: "DPRO / FGV", status: "Em andamento" },
            { id: 7, category: "Acesso às oportunidades de Saúde, Qualidade de Vida e Bem-estar no Trabalho", action: "Ampliação do quadro de psicólogos, inclusive descentralizados • Implementação do Protocolo de Saúde Mental (capacitação de equipes, acolhimento emocional, oficinas de gestão de conflitos). • Rodas de conversa, apoio psicossocial, atendimento interdisciplinar e campanhas de conscientização. • Inclusão dos resultados da Pesquisa de Satisfação 2025 no processo decisório.", prazo: "A partir de Out/2025", objetivo: "Promover saúde mental, inclusão e apoio efetivo aos servidores.", responsavel: "DPRO / SGA", status: "Planejamento" },
            { id: 8, category: "Acesso às oportunidades de Saúde, Qualidade de Vida e Bem-estar no Trabalho", action: "Estabelecer novas parcerias com operadoras de saúde com maior capilaridade nacional.", prazo: "mar/26", objetivo: "Ampliar o alcance das campanhas de vacinação para além das capitais, garantindo acesso mais equitativo.", responsavel: "DPRO / Operadoras de saúde", status: "Planejamento" },
            { id: 9, category: "Capacitação e Desenvolvimento Profissional", action: "Melhorar o LNC (Levantamento de Necessidades de Capacitação) para identificar a modalidade adequada a cada necessidade", prazo: "nov/26", objetivo: "Adequar as modalidades dos cursos ofertados", responsavel: "DPRO/ESAGU", status: "Planejamento" },
            { id: 10, category: "Capacitação e Desenvolvimento Profissional", action: "Implementar Capacitação de líderes para melhoria da gestão de prazos", prazo: "mar/25", objetivo: "Melhorar aspectos de percepção de qualidade de vid dos servidores como \"Recebimento de serviços no fim de semana com prazo para segunda\"", responsavel: "DPRO/ESAGU", status: "A iniciar" },
            { id: 11, category: "Capacitação e Desenvolvimento Profissional", action: "Garantir tempo protegido para capacitação (ex.: 2h mensais oficiais) • Conforme consultoria PNUD sobre nova forma de Gestão de Desempenho: Alterar normativo interno + Preparar sistema + Pactuação em planos de trabalho + Sensibilização", prazo: "2026", objetivo: "Superar dificuldade identificada de \"Volume de serviço impede acompanhar atividades do Desenvolvimento Profissional\"", responsavel: "DPRO", status: "A iniciar" },
            { id: 12, category: "Valorização do Servidor e Carreira", action: "Atuação em conjunto com SGCS", prazo: "2026", objetivo: "Demanda por plano de carreira com valorização da titulação", responsavel: "DPRO/SGA/SGCS", status: "Em andamento" },
            { id: 13, category: "Valorização do Servidor e Carreira", action: "Desenvolver política de incentivos vinculada à valorização profissional (Identificação de Telntos dentro da AGU e oferta de GECC para disseminação do conhecimento, valorizando os talentos internos e ao mesmo tempo capacitando novos servidores)", prazo: "2026", objetivo: "Pedidos por incentivos financeiros, gratificações e estímulos que motivem servidores a buscar capacitação", responsavel: "DPRO/SGA/SGCS", status: "Planejamento" },
            { id: 14, category: "Ergonomia", action: "Relançamento da cartilha de ergonomia em formato interativo, com vídeos e fotos, para facilitar ajustes autônomos pelos servidores. Realização da “Blitz da Ergonomia” com atendimentos presenciais voltados à identificação, correção e orientação nos postos de trabalho. Ampliação da comunicação institucional sobre ergonomia, via boletins, redes internas e treinamentos periódicos. Produção e oferta de microlearning com vídeos curtos (5 a 10 minutos) com pílulas de conhecimento ergonômico, acessíveis mesmo em rotinas sobrecarregadas. ", prazo: "nov/25", objetivo: "Percepção de falta de atenção institucional, ausência de divulgação de políticas de ergonomia e demora no atendimento às demandas. Sugestões para ações preventivas e de promoção da saúde (ginástica laboral, acompanhamento fisioterapêutico, equipes multiprofissionais).", responsavel: "DPRO", status: "Em andamento" },
            { id: 15, category: "Infraestrutura", action: "Encaminhamento para as SADS para levantamento de infraeestrutura", prazo: "nov/25", objetivo: "Melhorar o Conforto do ambiente de trabalho (Queixas sobre salas frias ou abafadas, iluminação precária (lâmpadas queimadas), barulho excessivo, infiltrações e até problemas estruturais, computadores, monitores, notebooks, lentidão, travamentos. (Reclamações sobre máquinas antigas, lentas, que prejudicam a produtividade. Também falta de webcams, fones e periféricos adequados.)", responsavel: "DPRO/SAD", status: "A iniciar" },
            { id: 16, category: "Modalidade de Trabalho", action: "Na definição do novo % de Teletrabalho integral foram escutados todos os órgãos e associações, sendo acatado o pedido de aumento em 5% nas modalidades de teletrabalho, anteiroenmente previstas com 30%e possibilidade de conversão da modalidade integral para semi para abranger um maior número de servidores contemplados com uma modalidade de teletrabalho", prazo: "N/A", objetivo: "Pedido por maior percentual de teletrabalho pleno.", responsavel: "N/A", status: "N/A" }
        ];
        
        const baseData = {
            "Sistemas e Processos": ["Dar clareza às opções do DFT e apoiar todos os órgãos SIPEC na utilização do SISDIP.", "Melhorar usabilidade, reduzir sobrecarga de alertas e ampliar funcionalidades estratégicas do PGD-e.", "Garantir acessibilidade e padronização dos formulários de serviços."],
            "Comunicação e Serviços da DPRO": ["Ampliar a divulgação e o entendimento sobre os serviços da DPRO, promovendo maior transparência e engajamento.", "Criar e implementar plano de comunicação em parceria com a ASCOM para envio de conteúdos curtos e informativos.", "Melhorar a gestão do conhecimento e a manualização dos serviços ofertados."],
            "Acesso às oportunidades de Saúde, Qualidade de Vida e Bem-estar no Trabalho": ["Promover saúde mental, inclusão e apoio efetivo aos servidores.", "Ampliar o alcance das campanhas de vacinação para além das capitais, garantindo acesso mais equitativo."],
            "Capacitação e Desenvolvimento Profissional": ["Adequar as modalidades dos cursos ofertados", "Melhorar aspectos de percepção de qualidade de vid dos servidores como \"Recebimento de serviços no fim de semana com prazo para segunda\"", "Superar dificuldade identificada de \"Volume de serviço impede acompanhar atividades do Desenvolvimento Profissional\""],
            "Valorização do Servidor e Carreira": ["Demanda por plano de carreira com valorização da titulação", "Pedidos por incentivos financeiros, gratificações e estímulos que motivem servidores a buscar capacitação"],
            "Ergonomia": ["Percepção de falta de atenção institucional, ausência de divulgação de políticas de ergonomia e demora no atendimento às demandas. Sugestões para ações preventivas e de promoção da saúde (ginástica laboral, acompanhamento fisioterapêutico, equipes multiprofissionais)."],
            "Infraestrutura": ["Melhorar o Conforto do ambiente de trabalho (Queixas sobre salas frias ou abafadas, iluminação precária (lâmpadas queimadas), barulho excessivo, infiltrações e até problemas estruturais, computadores, monitores, notebooks, lentidão, travamentos. (Reclamações sobre máquinas antigas, lentas, que prejudicam a produtividade. Também falta de webcams, fones e periféricos adequados.)"],
            "Modalidade de Trabalho": ["Pedido por maior percentual de teletrabalho pleno."]
        };

        // --- VARIÁVEIS GLOBAIS DOS GRÁFICOS ---
        let statusChartInstance = null;
        let deadlineChartInstance = null;

        // --- FUNÇÕES UTILITÁRIAS DE PARSING DE DATA ---
        function parsePrazo(prazoString) {
            if (!prazoString) return { datePart: '', obsPart: '' };
            const match = prazoString.match(/^(.*?)\s*\((.*)\)\s*$/);
            if (match) {
                return { datePart: match[1].trim(), obsPart: match[2].trim() };
            }
            return { datePart: prazoString.trim(), obsPart: '' };
        }

        function formatPrazoToInputDate(prazoString) {
            if (!prazoString) return null;
            let match = prazoString.match(/^(\d{4})-(\d{2})-(\d{2})$/);
            if (match) return prazoString;

            const lowerPrazo = prazoString.toLowerCase();
            const monthMap = { jan: '01', fev: '02', mar: '03', abr: '04', mai: '05', jun: '06', jul: '07', ago: '08', set: '09', out: '10', nov: '11', dez: '12' };
            
            match = lowerPrazo.match(/(\w+)\/(\d{2})/);
            if (match) {
                const month = monthMap[match[1].substring(0, 3)];
                const year = `20${match[2]}`;
                if (month) {
                    const lastDay = new Date(year, parseInt(month), 0).getDate();
                    return `${year}-${month}-${String(lastDay).padStart(2, '0')}`;
                }
            }
            
            match = lowerPrazo.match(/^(\d{4})$/);
            if (match) return `${match[1]}-12-31`;
            
            return null;
        }

        function parsePrazoToDate(prazoString) {
            const inputDate = formatPrazoToInputDate(prazoString);
            if (inputDate) {
                 // Adjust for timezone issues by creating date in UTC
                const [year, month, day] = inputDate.split('-').map(Number);
                return new Date(Date.UTC(year, month - 1, day));
            }
            return null;
        }
        
        // --- LÓGICA DAS ABAS ---
        const tabs = [
            { button: document.getElementById('graph-tab'), view: document.getElementById('graph-view') },
            { button: document.getElementById('plan-tab'), view: document.getElementById('plan-view') },
            { button: document.getElementById('dashboard-tab'), view: document.getElementById('dashboard-view') },
        ];

        tabs.forEach(tab => {
            tab.button.addEventListener('click', () => {
                tabs.forEach(t => {
                    t.view.classList.add('hidden');
                    t.button.classList.remove('active');
                });
                tab.view.classList.remove('hidden');
                tab.button.classList.add('active');
            });
        });

        // --- LÓGICA DO GRÁFICO PRINCIPAL ---
        const categories = Object.keys(baseData);
        const counts = categories.map(cat => baseData[cat].length);
        const ctx = document.getElementById('complaintsChart').getContext('2d');
        new Chart(ctx, { type: 'bar', data: { labels: categories, datasets: [{ label: 'Nº de Comentários e Sugestões', data: counts, backgroundColor: ['rgba(153, 102, 255, 0.6)','rgba(255, 206, 86, 0.6)','rgba(75, 192, 192, 0.6)','rgba(255, 159, 64, 0.6)','rgba(255, 99, 132, 0.6)','rgba(54, 162, 235, 0.6)', 'rgba(255, 99, 71, 0.6)', 'rgba(60, 179, 113, 0.6)', 'rgba(218, 112, 214, 0.6)'], borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { beginAtZero: true, title: { display: true, text: 'Número de Ocorrências' } } }, plugins: { legend: { display: false } }, onClick: (e, el) => { if (el.length > 0) openModal(categories[el[0].index]); } } });

        // --- LÓGICA DO DASHBOARD ---
        function updateDashboardCharts() {
            // 1. Gráfico de Status
            const statusCounts = planData.reduce((acc, item) => {
                const status = item.status || "N/A";
                acc[status] = (acc[status] || 0) + 1;
                return acc;
            }, {});
            
            const statusLabels = Object.keys(statusCounts);
            const statusData = Object.values(statusCounts);
            const statusColors = statusLabels.map(label => ({
                "A iniciar": "#fecaca", "Em andamento": "#fef08a", "Concluído": "#bbf7d0", 
                "Contínuo": "#bfdbfe", "Planejamento": "#e9d5ff", "N/A": "#e5e7eb"
            }[label] || '#cccccc'));

            const statusCtx = document.getElementById('statusChart').getContext('2d');
            if (statusChartInstance) statusChartInstance.destroy();
            statusChartInstance = new Chart(statusCtx, {
                type: 'doughnut',
                data: { labels: statusLabels, datasets: [{ data: statusData, backgroundColor: statusColors, borderWidth: 1 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } }
            });

            // 2. Gráfico de Linha de Prazos
            const deadlineCountsByMonth = {};
            planData.forEach(item => {
                if (item.status !== 'Concluído' && item.status !== 'N/A') {
                    const { datePart } = parsePrazo(item.prazo);
                    const prazoDate = parsePrazoToDate(datePart);
                    if(prazoDate) {
                        const monthKey = `${prazoDate.getUTCFullYear()}-${(prazoDate.getUTCMonth() + 1).toString().padStart(2, '0')}`;
                        deadlineCountsByMonth[monthKey] = (deadlineCountsByMonth[monthKey] || 0) + 1;
                    }
                }
            });

            const sortedMonths = Object.keys(deadlineCountsByMonth).sort();
            const deadlineLabels = sortedMonths.map(monthKey => {
                const [year, month] = monthKey.split('-');
                const monthName = new Date(Date.UTC(year, month - 1)).toLocaleString('pt-BR', { month: 'short', timeZone: 'UTC' });
                return `${monthName.charAt(0).toUpperCase() + monthName.slice(1)}/${year.slice(2)}`;
            });
            const deadlineData = sortedMonths.map(monthKey => deadlineCountsByMonth[monthKey]);

            const deadlineCtx = document.getElementById('deadlineChart').getContext('2d');
            if (deadlineChartInstance) deadlineChartInstance.destroy();
            deadlineChartInstance = new Chart(deadlineCtx, {
                type: 'line',
                data: {
                    labels: deadlineLabels,
                    datasets: [{ label: 'Nº de Ações Pendentes', data: deadlineData, fill: true, backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: 'rgba(59, 130, 246, 1)', tension: 0.3 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
            });
        }

        // --- LÓGICA DA TABELA DO PLANO DE AÇÃO ---
        const tbody = document.getElementById('action-plan-tbody');
        function renderActionPlanTable() {
            tbody.innerHTML = '';
            planData.forEach(item => {
                const tr = document.createElement('tr');
                const statusClass = { "A iniciar": "status-A-iniciar", "Em andamento": "status-Em-andamento", "Concluído": "status-Concluído", "Contínuo": "status-Contínuo", "Planejamento": "status-Planejamento", "N/A": "status-NA" }[item.status] || "";
                tr.className = statusClass;

                const tdPrazo = document.createElement('td');
                tdPrazo.className = 'px-6 py-4 text-sm text-gray-800 align-top';
                
                const { datePart, obsPart } = parsePrazo(item.prazo);
                const inputDateValue = formatPrazoToInputDate(datePart);

                if (inputDateValue) {
                    const prazoInput = document.createElement('input');
                    prazoInput.type = 'date'; 
                    prazoInput.value = inputDateValue;
                    prazoInput.className = 'border-gray-300 rounded-md shadow-sm w-full';
                    prazoInput.onchange = () => handlePrazoChange(item.id, prazoInput.value, obsPart);
                    tdPrazo.appendChild(prazoInput);
                } else {
                    const textNode = document.createElement('div');
                    textNode.textContent = datePart;
                    tdPrazo.appendChild(textNode);
                }
                
                if (obsPart) {
                    const obsSpan = document.createElement('span');
                    obsSpan.className = 'text-xs text-gray-500 block mt-1 italic';
                    obsSpan.textContent = `(${obsPart})`;
                    tdPrazo.appendChild(obsSpan);
                }
                
                const tdStatus = document.createElement('td');
                tdStatus.className = 'px-6 py-4 whitespace-normal align-top';
                const statusSelect = document.createElement('select');
                statusSelect.className = 'border-gray-300 rounded-md shadow-sm w-full';
                ['A iniciar', 'Em andamento', 'Concluído', 'Contínuo', 'Planejamento', 'N/A'].forEach(status => {
                    const option = document.createElement('option');
                    option.value = status; option.textContent = status;
                    if (item.status === status) option.selected = true;
                    statusSelect.appendChild(option);
                });
                if (item.status === 'N/A') statusSelect.disabled = true;
                statusSelect.onchange = () => handleStatusChange(item.id, statusSelect.value);
                tdStatus.appendChild(statusSelect);
                
                tr.innerHTML = `<td class="px-6 py-4 whitespace-normal text-sm font-medium text-gray-900 align-top">${item.category}</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-800 align-top">${item.action}</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-800 align-top">${item.objetivo}</td><td class="px-6 py-4 whitespace-normal text-sm text-gray-800 align-top">${item.responsavel}</td>`;
                tr.append(tdPrazo, tdStatus);
                tbody.appendChild(tr);
            });
        }
        
        function handleStatusChange(id, newStatus) {
            const item = planData.find(i => i.id === id);
            if (item) {
                item.status = newStatus;
                renderActionPlanTable();
                updateDashboardCharts();
            }
        }

        function handlePrazoChange(id, newDateISO, originalObsPart) {
            const item = planData.find(i => i.id === id);
            if (item) {
                const [y, m, d] = newDateISO.split('-');
                let formattedDate = `${d}/${m}/${y.slice(2)}`; // Reformat to keep it simple, e.g., 31/03/25
                
                let newPrazo = formattedDate;
                if (originalObsPart) {
                    newPrazo = `${newPrazo} (${originalObsPart})`;
                }
                item.prazo = newPrazo;
                renderActionPlanTable(); // Re-render to show the new simple format
                updateDashboardCharts();
            }
        }

        // --- LÓGICA DO MODAL (VISÃO GRÁFICA) ---
        const modal = document.getElementById('detailsModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        function openModal(category) {
            const observations = baseData[category] || [];
            modalTitle.textContent = `Comentários e Sugestões: ${category}`;
            modalBody.innerHTML = '';
            if (observations.length > 0) {
                const ul = document.createElement('ul');
                ul.className = 'list-disc list-inside space-y-2 text-gray-700';
                observations.forEach(obs => {
                    const li = document.createElement('li');
                    li.textContent = obs;
                    ul.appendChild(li);
                });
                modalBody.appendChild(ul);
            } else { modalBody.innerHTML = '<p class="text-gray-500">Nenhum item encontrado.</p>'; }
            modal.classList.add('visible');
        }
        function closeModal() { modal.classList.remove('visible'); }
        modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

        // --- INICIALIZAÇÃO ---
        document.addEventListener('DOMContentLoaded', () => {
            renderActionPlanTable();
            updateDashboardCharts();
        });
    </script>
</body>
</html>

